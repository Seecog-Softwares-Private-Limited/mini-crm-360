<div class="container-fluid">
  <div class="row">
    {{> sidebar}}

    <div class="col-md-9 col-lg-10 main-content">
      <div class="container-fluid p-4">
        <style>
          /* ============================================
             WORLD-CLASS PREMIUM REMINDERS PAGE STYLING
             ============================================ */
          
          /* Page Background */
          .main-content {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            position: relative;
          }

          .main-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
              radial-gradient(circle at 20% 50%, rgba(102, 126, 234, 0.05) 0%, transparent 50%),
              radial-gradient(circle at 80% 80%, rgba(118, 75, 162, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
          }

          .container-fluid.p-4 {
            position: relative;
          }

          /* Premium Header */
          .reminders-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 24px;
            padding: 3rem 2.5rem;
            margin-bottom: 2.5rem;
            color: white;
            box-shadow: 
              0 20px 60px rgba(102, 126, 234, 0.4),
              0 0 0 1px rgba(255, 255, 255, 0.1) inset;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
          }

          .reminders-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: shimmer 8s infinite;
          }

          @keyframes shimmer {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
          }

          .reminders-header h2 {
            margin: 0;
            font-weight: 800;
            font-size: 2.5rem;
            letter-spacing: -0.5px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
          }

          .reminders-header p {
            margin: 0.75rem 0 0 0;
            opacity: 0.95;
            font-size: 1.1rem;
            font-weight: 400;
            position: relative;
            z-index: 1;
          }

          /* Filter Tabs */
          .filter-tabs {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            background: white;
            padding: 0.5rem;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
          }

          .filter-tab {
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #64748b;
            background: transparent;
            border: 2px solid transparent;
          }

          .filter-tab:hover {
            background: #f1f5f9;
            color: #475569;
          }

          .filter-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
          }

          /* Reminders List */
          .reminders-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
          }

          .reminder-item {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 
              0 4px 12px rgba(0, 0, 0, 0.08),
              0 0 0 1px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            border-left: 5px solid;
            position: relative;
            overflow: hidden;
          }

          .reminder-item:hover {
            transform: translateX(4px);
            box-shadow: 
              0 8px 20px rgba(0, 0, 0, 0.12),
              0 0 0 1px rgba(0, 0, 0, 0.05);
          }

          .reminder-item.birthday {
            border-left-color: #ec4899;
            background: linear-gradient(135deg, #ffffff 0%, #fdf2f8 100%);
          }

          .reminder-item.anniversary {
            border-left-color: #f59e0b;
            background: linear-gradient(135deg, #ffffff 0%, #fffbeb 100%);
          }

          .reminder-item.today {
            border-left-color: #10b981;
            animation: pulse-border 2s infinite;
          }

          @keyframes pulse-border {
            0%, 100% { border-left-width: 5px; }
            50% { border-left-width: 8px; }
          }

          .reminder-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
          }

          .reminder-info {
            flex: 1;
          }

          .reminder-customer-name {
            font-weight: 700;
            font-size: 1.25rem;
            color: #1f2937;
            margin-bottom: 0.25rem;
          }

          .reminder-type-badge {
            display: inline-block;
            padding: 0.375rem 0.875rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 0.5rem;
          }

          .reminder-type-badge.birthday {
            background: #fce7f3;
            color: #db2777;
          }

          .reminder-type-badge.anniversary {
            background: #fef3c7;
            color: #d97706;
          }

          .reminder-date-info {
            text-align: right;
          }

          .reminder-days-until {
            font-size: 2rem;
            font-weight: 800;
            color: #667eea;
            line-height: 1;
            margin-bottom: 0.25rem;
          }

          .reminder-days-until.today {
            color: #10b981;
            animation: pulse-text 2s infinite;
          }

          @keyframes pulse-text {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
          }

          .reminder-date-label {
            font-size: 0.75rem;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
          }

          .reminder-date-value {
            font-size: 0.9rem;
            color: #4b5563;
            margin-top: 0.25rem;
          }

          .reminder-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
          }

          .reminder-action-btn {
            padding: 0.625rem 1.25rem;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.875rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
          }

          .reminder-action-btn.whatsapp {
            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);
          }

          .reminder-action-btn.whatsapp:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
          }

          .reminder-action-btn.email {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
          }

          .reminder-action-btn.email:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
          }

          .reminder-action-btn.edit {
            background: #f3f4f6;
            color: #64748b;
            border: 2px solid #e5e7eb;
          }

          .reminder-action-btn.edit:hover {
            background: #e5e7eb;
            color: #475569;
          }

          /* Empty State */
          .reminders-empty {
            text-align: center;
            padding: 4rem 2rem;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
          }

          .reminders-empty i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
            color: #9ca3af;
          }

          /* Premium Modal */
          .premium-modal {
            z-index: 1055 !important;
          }

          .premium-modal .modal-dialog {
            z-index: 1056 !important;
            pointer-events: auto !important;
            margin: 1.75rem auto;
            animation: modalSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
          }

          @keyframes modalSlideIn {
            from {
              opacity: 0;
              transform: translateY(-50px) scale(0.95);
            }
            to {
              opacity: 1;
              transform: translateY(0) scale(1);
            }
          }

          .premium-modal .modal-content {
            border-radius: 28px;
            overflow: hidden;
            border: none;
            box-shadow: 
              0 40px 100px rgba(0, 0, 0, 0.5),
              0 0 0 1px rgba(255, 255, 255, 0.15) inset,
              0 20px 60px rgba(102, 126, 234, 0.3);
            pointer-events: auto !important;
            position: relative;
            z-index: 1057 !important;
            background: #ffffff;
            backdrop-filter: blur(20px);
          }

          .premium-modal .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, 
              #667eea 0%, 
              #764ba2 25%, 
              #f093fb 50%, 
              #4facfe 75%, 
              #667eea 100%);
            background-size: 200% 100%;
            animation: gradientShift 3s ease infinite;
          }

          @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
          }

          .premium-modal .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 200% 200%;
            animation: gradientMove 8s ease infinite;
            color: white;
            padding: 3rem 3rem 2.5rem;
            border-bottom: none;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
          }

          @keyframes gradientMove {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
          }

          .premium-modal .modal-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
            pointer-events: none;
          }

          .premium-modal .modal-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
              transparent 0%, 
              rgba(255, 255, 255, 0.3) 50%, 
              transparent 100%);
          }

          .premium-modal .modal-title {
            font-weight: 800;
            font-size: 2rem;
            position: relative;
            z-index: 1;
            letter-spacing: -0.8px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 0.75rem;
          }

          .premium-modal .modal-title i {
            font-size: 1.5rem;
            opacity: 0.95;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
          }

          .premium-modal .btn-close {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            opacity: 1;
            padding: 0.75rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 2;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
          }

          .premium-modal .btn-close:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: rotate(90deg) scale(1.1);
            border-color: rgba(255, 255, 255, 0.5);
          }

          .premium-modal .modal-body {
            padding: 3rem;
            background: linear-gradient(135deg, #fafbfc 0%, #ffffff 50%, #f8fafc 100%);
            position: relative;
            overflow: hidden;
          }

          .premium-modal .modal-body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
              transparent 0%, 
              rgba(102, 126, 234, 0.1) 50%, 
              transparent 100%);
          }

          .premium-modal .form-label {
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.875rem;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
            padding-left: 0.5rem;
          }

          .premium-modal .form-label::before {
            content: '';
            width: 5px;
            height: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 3px;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
            flex-shrink: 0;
          }

          .premium-modal .form-control {
            border-radius: 14px;
            border: 2px solid #e2e8f0;
            padding: 1rem 1.5rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.95rem;
            background: #ffffff;
            box-shadow: 
              0 2px 8px rgba(0, 0, 0, 0.04),
              0 0 0 0 rgba(102, 126, 234, 0);
            color: #1e293b;
            font-weight: 500;
          }

          .premium-modal .form-control:hover {
            border-color: #cbd5e1;
            box-shadow: 
              0 4px 16px rgba(0, 0, 0, 0.08),
              0 0 0 2px rgba(102, 126, 234, 0.05);
            transform: translateY(-1px);
            background: #fefefe;
          }

          .premium-modal .form-control:focus {
            border-color: #667eea;
            box-shadow: 
              0 0 0 4px rgba(102, 126, 234, 0.12),
              0 6px 20px rgba(102, 126, 234, 0.2),
              0 2px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
            outline: none;
            background: #ffffff;
          }

          .premium-modal .form-control::placeholder {
            color: #94a3b8;
            font-style: italic;
            font-weight: 400;
            opacity: 0.8;
          }

          .premium-modal .form-select {
            border-radius: 14px;
            border: 2px solid #e2e8f0;
            padding: 1rem 1.5rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.95rem;
            background: #ffffff;
            box-shadow: 
              0 2px 8px rgba(0, 0, 0, 0.04),
              0 0 0 0 rgba(102, 126, 234, 0);
            color: #1e293b;
            font-weight: 500;
            cursor: pointer;
          }

          .premium-modal .form-select:hover {
            border-color: #cbd5e1;
            box-shadow: 
              0 4px 16px rgba(0, 0, 0, 0.08),
              0 0 0 2px rgba(102, 126, 234, 0.05);
            transform: translateY(-1px);
          }

          .premium-modal .form-select:focus {
            border-color: #667eea;
            box-shadow: 
              0 0 0 4px rgba(102, 126, 234, 0.12),
              0 6px 20px rgba(102, 126, 234, 0.2),
              0 2px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
            outline: none;
          }

          .premium-modal .modal-footer {
            border-top: 1px solid #e2e8f0;
            padding: 2.5rem 3rem;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #f1f5f9 100%);
            position: relative;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
          }

          .premium-modal .modal-footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
              transparent 0%, 
              rgba(102, 126, 234, 0.1) 50%, 
              transparent 100%);
          }

          .premium-modal .btn {
            border-radius: 14px;
            padding: 1rem 2.75rem;
            font-weight: 700;
            font-size: 0.95rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
          }

          .premium-modal .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 200% 200%;
            animation: gradientMove 3s ease infinite;
            color: white;
            box-shadow: 
              0 6px 20px rgba(102, 126, 234, 0.4),
              0 2px 8px rgba(102, 126, 234, 0.3),
              inset 0 1px 0 rgba(255, 255, 255, 0.2);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1;
          }

          .premium-modal .btn-primary:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
              0 12px 35px rgba(102, 126, 234, 0.5),
              0 4px 12px rgba(102, 126, 234, 0.4),
              0 0 0 4px rgba(102, 126, 234, 0.15),
              inset 0 1px 0 rgba(255, 255, 255, 0.3);
            background-position: 100% 50%;
          }

          .premium-modal .btn-secondary {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 2px solid #e2e8f0;
            color: #64748b;
            box-shadow: 
              0 2px 8px rgba(0, 0, 0, 0.05),
              inset 0 1px 0 rgba(255, 255, 255, 0.8);
            font-weight: 600;
          }

          .premium-modal .btn-secondary:hover {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-color: #cbd5e1;
            transform: translateY(-2px);
            color: #475569;
          }

          /* Ensure all form elements are clickable */
          .premium-modal input,
          .premium-modal select,
          .premium-modal textarea,
          .premium-modal button,
          .premium-modal .btn-close {
            pointer-events: auto !important;
            cursor: pointer;
          }

          .premium-modal input[type="text"],
          .premium-modal input[type="date"],
          .premium-modal textarea {
            cursor: text !important;
          }

          body.modal-open {
            overflow: hidden;
            padding-right: 0 !important;
          }

          .modal-backdrop {
            z-index: 1050 !important;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
          }
        </style>

        <!-- Header -->
        <div class="reminders-header">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h2><i class="fas fa-birthday-cake me-2"></i>Birthday & Anniversary Reminders</h2>
              <p class="mb-0 mt-2 opacity-90">Never miss a special occasion - send wishes automatically</p>
            </div>
          </div>
        </div>

        <!-- Filter Tabs -->
        <div class="filter-tabs">
          <div class="filter-tab active" onclick="filterReminders('all')" data-filter="all">All</div>
          <div class="filter-tab" onclick="filterReminders('today')" data-filter="today">Today</div>
          <div class="filter-tab" onclick="filterReminders('birthday')" data-filter="birthday">Birthdays</div>
          <div class="filter-tab" onclick="filterReminders('anniversary')" data-filter="anniversary">Anniversaries</div>
          <div class="filter-tab" onclick="filterReminders('upcoming')" data-filter="upcoming">Upcoming (7 days)</div>
        </div>

        <!-- Reminders List -->
        <div class="reminders-list" id="remindersList">
          <div class="text-center p-5">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-3 text-muted">Loading reminders...</p>
          </div>
        </div>

        <!-- Edit Date Modal -->
        <div class="modal fade premium-modal" id="editDateModal" tabindex="-1" aria-labelledby="editDateModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="editDateModalLabel">
                  <i class="fas fa-calendar-alt me-2"></i>Edit Date
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form id="editDateForm">
                  <input type="hidden" id="editCustomerId" name="customerId">
                  <div class="mb-3">
                    <label for="editDateOfBirth" class="form-label">Date of Birth</label>
                    <input type="date" class="form-control" id="editDateOfBirth" name="dateOfBirth">
                  </div>
                  <div class="mb-3">
                    <label for="editAnniversaryDate" class="form-label">Anniversary Date</label>
                    <input type="date" class="form-control" id="editAnniversaryDate" name="anniversaryDate">
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveDate()">
                  <i class="fas fa-save me-2"></i>Save
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Send Wish Modal -->
        <div class="modal fade premium-modal" id="sendWishModal" tabindex="-1" aria-labelledby="sendWishModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="sendWishModalLabel">
                  <i class="fas fa-paper-plane me-2"></i>Send Wish
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form id="sendWishForm">
                  <input type="hidden" id="wishCustomerId" name="customerId">
                  <input type="hidden" id="wishType" name="type">
                  
                  <div class="mb-3">
                    <label for="wishChannel" class="form-label">Channel *</label>
                    <select class="form-select" id="wishChannel" name="channel" required onchange="loadTemplates()">
                      <option value="">Select Channel</option>
                      <option value="whatsapp">WhatsApp</option>
                      <option value="email">Email</option>
                    </select>
                  </div>

                  <div class="mb-3" id="whatsappTemplateGroup" style="display: none;">
                    <label for="whatsappTemplate" class="form-label">WhatsApp Template</label>
                    <select class="form-select" id="whatsappTemplate" name="templateId">
                      <option value="">Select Template (Optional)</option>
                    </select>
                  </div>

                  <div class="mb-3" id="emailTemplateGroup" style="display: none;">
                    <label for="emailTemplate" class="form-label">Email Template</label>
                    <select class="form-select" id="emailTemplate" name="emailTemplateId">
                      <option value="">Select Template (Optional)</option>
                    </select>
                  </div>

                  <div class="mb-3" id="customMessageGroup" style="display: none;">
                    <label for="customMessage" class="form-label">Custom Message</label>
                    <textarea class="form-control" id="customMessage" name="customMessage" rows="4" placeholder="Enter your custom message (if not using template)..."></textarea>
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="sendWish()">
                  <i class="fas fa-paper-plane me-2"></i>Send Wish
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const API_BASE = '{{apiBase}}' || 'http://localhost:3002/api/v1';
  let allReminders = [];
  let currentFilter = 'all';
  let allTemplates = [];
  let allEmailTemplates = [];

  // Load reminders on page load
  document.addEventListener('DOMContentLoaded', () => {
    loadReminders();
  });

  // Load reminders
  async function loadReminders() {
    try {
      const response = await fetch(`${API_BASE}/reminders?days=30`, {
        method: 'GET',
        credentials: 'include'
      });

      if (response.ok) {
        const result = await response.json();
        allReminders = result.data || result.reminders || [];
        displayReminders(allReminders);
      } else {
        throw new Error('Failed to load reminders');
      }
    } catch (error) {
      console.error('Error loading reminders:', error);
      document.getElementById('remindersList').innerHTML = `
        <div class="reminders-empty">
          <i class="fas fa-exclamation-triangle text-danger"></i>
          <h4>Error loading reminders</h4>
          <p>Please try again later</p>
        </div>
      `;
    }
  }

  // Filter reminders
  function filterReminders(filter) {
    currentFilter = filter;
    
    // Update active tab
    document.querySelectorAll('.filter-tab').forEach(tab => {
      tab.classList.remove('active');
      if (tab.dataset.filter === filter) {
        tab.classList.add('active');
      }
    });

    let filtered = allReminders;

    if (filter === 'today') {
      filtered = allReminders.filter(r => r.isToday);
    } else if (filter === 'birthday') {
      filtered = allReminders.filter(r => r.type === 'birthday');
    } else if (filter === 'anniversary') {
      filtered = allReminders.filter(r => r.type === 'anniversary');
    } else if (filter === 'upcoming') {
      filtered = allReminders.filter(r => r.daysUntil > 0 && r.daysUntil <= 7);
    }

    displayReminders(filtered);
  }

  // Display reminders
  function displayReminders(reminders) {
    const container = document.getElementById('remindersList');

    if (reminders.length === 0) {
      container.innerHTML = `
        <div class="reminders-empty">
          <i class="fas fa-birthday-cake"></i>
          <h4>No reminders found</h4>
          <p>Add dates of birth and anniversaries to customers to see reminders here</p>
        </div>
      `;
      return;
    }

    const remindersHTML = reminders.map(reminder => {
      const dateStr = new Date(reminder.date).toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric',
        year: reminder.daysUntil > 365 ? 'numeric' : undefined
      });

      return `
        <div class="reminder-item ${reminder.type} ${reminder.isToday ? 'today' : ''}">
          <div class="reminder-header">
            <div class="reminder-info">
              <div class="reminder-customer-name">${escapeHtml(reminder.customerName)}</div>
              <span class="reminder-type-badge ${reminder.type}">
                ${reminder.type === 'birthday' ? 'üéÇ Birthday' : 'üíç Anniversary'}
              </span>
            </div>
            <div class="reminder-date-info">
              <div class="reminder-days-until ${reminder.isToday ? 'today' : ''}">
                ${reminder.isToday ? 'Today!' : reminder.daysUntil === 1 ? 'Tomorrow' : `${reminder.daysUntil} days`}
              </div>
              <div class="reminder-date-label">${reminder.isToday ? 'TODAY' : 'UNTIL'}</div>
              <div class="reminder-date-value">${dateStr}</div>
            </div>
          </div>
          <div class="reminder-actions">
            <button class="reminder-action-btn whatsapp" onclick="showSendWishModal(${reminder.customerId}, '${reminder.type}', 'whatsapp')" ${!reminder.phoneE164 ? 'disabled title="Customer has no WhatsApp number"' : ''}>
              <i class="fab fa-whatsapp"></i>Send WhatsApp
            </button>
            <button class="reminder-action-btn email" onclick="showSendWishModal(${reminder.customerId}, '${reminder.type}', 'email')" ${!reminder.email ? 'disabled title="Customer has no email"' : ''}>
              <i class="fas fa-envelope"></i>Send Email
            </button>
            <button class="reminder-action-btn edit" onclick="showEditDateModal(${reminder.customerId})">
              <i class="fas fa-edit"></i>Edit Date
            </button>
          </div>
        </div>
      `;
    }).join('');

    container.innerHTML = remindersHTML;
  }

  // Show edit date modal
  async function showEditDateModal(customerId) {
    try {
      const response = await fetch(`${API_BASE}/customers?pageSize=1000`, {
        method: 'GET',
        credentials: 'include'
      });

      if (response.ok) {
        const result = await response.json();
        const customers = result.data || result.data?.customers || result.customers || [];
        const customer = customers.find(c => c.id === customerId);

        if (customer) {
          document.getElementById('editCustomerId').value = customerId;
          document.getElementById('editDateOfBirth').value = customer.dateOfBirth || '';
          document.getElementById('editAnniversaryDate').value = customer.anniversaryDate || '';
          new bootstrap.Modal(document.getElementById('editDateModal')).show();
        }
      }
    } catch (error) {
      console.error('Error loading customer:', error);
    }
  }

  // Save date
  async function saveDate() {
    const customerId = document.getElementById('editCustomerId').value;
    const dateOfBirth = document.getElementById('editDateOfBirth').value || null;
    const anniversaryDate = document.getElementById('editAnniversaryDate').value || null;

    try {
      const response = await fetch(`${API_BASE}/reminders/customer/${customerId}`, {
        method: 'PUT',
        credentials: 'include',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          dateOfBirth,
          anniversaryDate
        })
      });

      const result = await response.json();

      if (response.ok) {
        bootstrap.Modal.getInstance(document.getElementById('editDateModal')).hide();
        loadReminders();
      } else {
        alert(result.message || 'Failed to save date');
      }
    } catch (error) {
      console.error('Error saving date:', error);
      alert('Failed to save date. Please try again.');
    }
  }

  // Show send wish modal
  async function showSendWishModal(customerId, type, channel) {
    document.getElementById('wishCustomerId').value = customerId;
    document.getElementById('wishType').value = type;
    document.getElementById('wishChannel').value = channel;
    document.getElementById('whatsappTemplateGroup').style.display = 'none';
    document.getElementById('emailTemplateGroup').style.display = 'none';
    document.getElementById('customMessageGroup').style.display = 'none';

    if (channel === 'whatsapp') {
      document.getElementById('whatsappTemplateGroup').style.display = 'block';
      document.getElementById('customMessageGroup').style.display = 'block';
      await loadWhatsAppTemplates();
    } else if (channel === 'email') {
      document.getElementById('emailTemplateGroup').style.display = 'block';
      document.getElementById('customMessageGroup').style.display = 'block';
      await loadEmailTemplates();
    }

    new bootstrap.Modal(document.getElementById('sendWishModal')).show();
  }

  // Load templates when channel changes
  async function loadTemplates() {
    const channel = document.getElementById('wishChannel').value;
    document.getElementById('whatsappTemplateGroup').style.display = 'none';
    document.getElementById('emailTemplateGroup').style.display = 'none';
    document.getElementById('customMessageGroup').style.display = 'none';

    if (channel === 'whatsapp') {
      document.getElementById('whatsappTemplateGroup').style.display = 'block';
      document.getElementById('customMessageGroup').style.display = 'block';
      await loadWhatsAppTemplates();
    } else if (channel === 'email') {
      document.getElementById('emailTemplateGroup').style.display = 'block';
      document.getElementById('customMessageGroup').style.display = 'block';
      await loadEmailTemplates();
    }
  }

  // Load WhatsApp templates
  async function loadWhatsAppTemplates() {
    try {
      const response = await fetch(`${API_BASE}/templates`, {
        method: 'GET',
        credentials: 'include'
      });

      if (response.ok) {
        const result = await response.json();
        allTemplates = result.data || result.templates || [];

        const select = document.getElementById('whatsappTemplate');
        select.innerHTML = '<option value="">Select Template (Optional)</option>';
        allTemplates.forEach(template => {
          const option = document.createElement('option');
          option.value = template.id;
          option.textContent = template.name || template.waName || 'Unnamed Template';
          select.appendChild(option);
        });
      }
    } catch (error) {
      console.error('Error loading WhatsApp templates:', error);
    }
  }

  // Load Email templates
  async function loadEmailTemplates() {
    try {
      const response = await fetch(`${API_BASE}/email-templates`, {
        method: 'GET',
        credentials: 'include'
      });

      if (response.ok) {
        const result = await response.json();
        allEmailTemplates = result.data || result.emailTemplates || [];

        const select = document.getElementById('emailTemplate');
        select.innerHTML = '<option value="">Select Template (Optional)</option>';
        allEmailTemplates.forEach(template => {
          const option = document.createElement('option');
          option.value = template.id;
          option.textContent = template.name || 'Unnamed Template';
          select.appendChild(option);
        });
      }
    } catch (error) {
      console.error('Error loading email templates:', error);
    }
  }

  // Send wish
  async function sendWish() {
    const form = document.getElementById('sendWishForm');
    if (!form.checkValidity()) {
      form.reportValidity();
      return;
    }

    const customerId = document.getElementById('wishCustomerId').value;
    const type = document.getElementById('wishType').value;
    const channel = document.getElementById('wishChannel').value;
    const templateId = document.getElementById('whatsappTemplate').value || null;
    const emailTemplateId = document.getElementById('emailTemplate').value || null;
    const customMessage = document.getElementById('customMessage').value || null;

    try {
      const response = await fetch(`${API_BASE}/reminders/send-wish`, {
        method: 'POST',
        credentials: 'include',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          customerId: parseInt(customerId),
          type,
          channel,
          templateId: templateId ? parseInt(templateId) : null,
          emailTemplateId: emailTemplateId ? parseInt(emailTemplateId) : null,
          customMessage
        })
      });

      const result = await response.json();

      if (response.ok) {
        bootstrap.Modal.getInstance(document.getElementById('sendWishModal')).hide();
        alert(`‚úÖ ${type === 'birthday' ? 'Birthday' : 'Anniversary'} wish sent successfully via ${channel}!`);
        loadReminders();
      } else {
        alert(result.message || 'Failed to send wish');
      }
    } catch (error) {
      console.error('Error sending wish:', error);
      alert('Failed to send wish. Please try again.');
    }
  }

  // Escape HTML
  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }
</script>


